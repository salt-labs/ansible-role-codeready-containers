---

#########################
# Tasks (Remote Install)
#########################

- name: "Install HAProxy"
  include_tasks:
    file: tasks/server/remote/haproxy/main.yml
    apply:
      tags:
        - haproxy
        - install
  vars:
    type: Install
    state: present
  when:
    - crc_server_install | bool
    - crc_remote_haproxy | bool
  tags:
    - haproxy
    - install

- name: "Install DNSmasq"
  include_tasks:
    file: tasks/server/remote/dnsmasq/main.yml
    apply:
      tags:
        - dnsmasq
        - install
  vars:
    type: Install
    state: present
  when:
    - crc_server_install | bool
    - crc_remote_dnsmasq | bool
  tags:
    - dnsmasq
    - install

- name: Restart NetworkManager
  systemd:
    name: NetworkManager
    state: restarted
  when:
    - not ansible_check_mode
    - ( crc_remote_haproxy | bool ) or ( crc_remote_dnsmasq | bool )
